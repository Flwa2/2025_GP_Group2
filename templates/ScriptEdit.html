<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WeCast • Edit Script</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-app">

  <header class="app-header">
    <a href="{{ url_for('home') }}" class="logo-link">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="WeCast Logo" class="app-logo">
      <span class="logo-text">WeCast</span>
    </a>
  </header>

  <div class="main-container">
    <h1 class="title">Edit Your Podcast Script</h1>

    <!-- Progress Wizard: 1 and 2 are done, 3 is active -->
    <div class="wizard">
      <div class="wizard-step">
        <div id="wiz-1" class="wizard-dot wiz-done">1</div>
        <div class="wizard-label">Settings</div>
      </div>

      <div id="line-12" class="wizard-line wizard-line--on"></div>

      <div class="wizard-step">
        <div id="wiz-2" class="wizard-dot wiz-done">2</div>
        <div class="wizard-label">Text</div>
      </div>

      <div id="line-23" class="wizard-line wizard-line--on"></div>

      <div class="wizard-step">
        <div id="wiz-3" class="wizard-dot wiz-active">3</div>
        <div class="wizard-label">Edit</div>
      </div>
    </div>

    <div class="form-card">
      <div class="guidelines-box">
        <h2>Editing Guidelines</h2>
        <ul>
          <li>Do not delete speaker names or their entire lines.</li>
          <li>Do not clear the whole script.</li>
          <li>You can only edit words after the speaker’s name.</li>
        </ul>
      </div>

      {% if error %}
        <div class="error-msg">{{ error }}</div>
      {% endif %}
      {% if success %}
        <div class="save-status">{{ success }}</div>
      {% endif %}

      <form method="POST" action="{{ url_for('edit') }}">
        <div class="script-container">
          <label for="scriptEditor">Your Script</label>
          <textarea id="scriptEditor" name="edited_script">{{ script or '' }}</textarea>
        </div>

      <div class="save-section" style="display:flex; align-items:center; gap:12px; justify-content:space-between; margin-top:14px;">
        <div class="flex-left" style="display:flex; gap:10px; align-items:center;">
          <a href="{{ url_for('create_page') }}?step=2&restore=1" class="secondary-btn">Back to Text</a>
          <button id="saveBtn" type="button" class="generate-btn">Save Script</button>
        </div>
        <span id="saveStatus" class="save-status">Not saved yet</span>
      </div>


      </form>
    </div>
  </div>
<script>
  const saveBtn = document.getElementById('saveBtn');
  const saveStatus = document.getElementById('saveStatus');
  const editor = document.getElementById('scriptEditor');

  saveBtn.addEventListener('click', async () => {
    const content = editor.value.trim();
    if (!content) {
      saveStatus.textContent = 'Script is empty.';
      saveStatus.style.color = '#ff6b6b';
      return;
    }

    saveStatus.textContent = 'Saving...';
    saveStatus.style.color = '#a0ffb4';

    try {
      const response = await fetch('{{ url_for("edit") }}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ edited_script: content })
      });

      if (response.ok) {
        saveStatus.textContent = 'Last saved: ' + new Date().toLocaleTimeString();
        saveStatus.style.color = '#10b981';
      } else {
        saveStatus.textContent = 'Failed to save.';
        saveStatus.style.color = '#ff6b6b';
      }
    } catch (err) {
      saveStatus.textContent = 'Error saving script.';
      saveStatus.style.color = '#ff6b6b';
    }
  });
</script>


</body>
</html>
